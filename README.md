# ESP32-Music-Visualizer-Light
尝试从功放板引出差分信号制作音乐律动灯

本项目尝试通过功放板MH-M38引出的差分模拟信号，经过差分转单端模块TPA6132，将信号转为单端的模拟信号，该模块偏置点位0.0V,故位满足esp32的adc输入要求后置了一个1.65V的偏置电路（由adc的3.3V和gnd之间串接两个103电阻进行偏置，并联一个滤波电容对电路进行滤波），然后接到ESP32开发板的ADC引脚进行数字信号采集，I2S采集采用采样点：512，采样频率：44100hz, 然后对采样进行kalman滤波，然后进行FFT计算，最后控制WS2812LED灯条随音乐律动。
另：本人纯小白，此diy项目灯光效果中部分代码参考网上其他作者代码及ChatGPT帮助完成，在此表示感谢，如有不慎侵权或代码中有错误不妥之处或您有更好的思路请联系652608495@qq.com。
作者：InnerPeace 

功能说明：
1.软件与开发环境
-Arduino IDE
-使用库：
       FastLED: 控制灯效
       WiFi   ：esp32原生wifi
       PubSubClient：MQTT服务器通讯
       ArduinoJson：解析和构建 JSON 数据结构
       arduinoFFT：音频频谱分析
       Preferences：EEPROM数据保存
       driver/i2s ：ADC获取音频

2. 网络连接
- 支持多WiFi自动切换连接
- MQTT客户端实现，连接第三方MQTT broker
- 订阅主题：命令下发、属性推送等

3.LED控制
- 10种灯光模式：mode 1-7. 静态灯光效果  mode 8-10. 音频可视化（3种风格）

4.音频处理
- I2S采样音频（44.1kHz，512点）
- FFT频谱分析
- 卡尔曼滤波降噪
- 双缓冲机制确保数据一致性

5.用户交互
- 按钮控制： 短按：切换灯光模式 ； 长按：调色/调亮度/调速度
- app远程控制：通过MQTT可修改颜色、亮度、模式等参数
- 状态记忆（使用Preferences存储设置）

6. 其他说明
- 多任务处理：音频采样在核心0运行
- 非阻塞式设计：所有延迟都使用millis()计时
- 低延迟：完整的音频采集+FFT处理约14.5ms	FPS约为69
  
